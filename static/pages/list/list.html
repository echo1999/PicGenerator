<!doctype html>

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <title>é€‰æ‹©éŸ³ä¹</title>
  <meta name="keywords" content="css3, html5, js, background video, fullscreen video">
  <link rel="stylesheet" href="list.css" type="text/css">
  <script>
    try {
      Typekit.load({
        async: true
      });
    } catch (e) { }
  </script>
  <style>
    #search {
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div id="container">
    <video id="background_video" loop muted></video>
    <div id="video_cover"></div>
    <div id="overlay"></div>

    <div id="top">
      <form class="filter-form">
        <input id="inputsearch" name="" placeholder="Input Music Name" type="text">
      </form>
      <img id="search" src="../../packages/æœç´¢.png" alt="æœç´¢" height=30%>
    </div>
    <div id="title">
      <div class="titleName">
        <p1>æ­Œæ›²å</p1>
      </div>
      <div class="titleSinger">
        <p>æ­Œæ‰‹</p>
      </div>
      <div class="titleAlbum">
        <p>ä¸“è¾‘</p>
      </div>
      <div class="titleTime">
        <p>æ—¶é•¿</p>
      </div>
    </div>

    <div id="main">
      <div id="list">
        <!-- è¯¥éƒ¨åˆ†ç”±jsä»£ç å¡«å…… -->
      </div>
    </div>
  </div>

  <script src="../bideo.js"></script>
  <script src="../main.js"></script>

  <script>
    if (window.location.host.indexOf('github.io') !== -1 && window.location.protocol !== "https:") {
      window.location.protocol = "https";
    }
  </script>
  <script src="./list.js"></script>
  <script src="../../packages/bigsea.js"></script>
  <script src="../analyse/js/jquery.min.js"></script>
  <script type="text/javascript">
    Sea('#search').on('click', function () {
      Sea.Ajax({
        url: '/list.search',
        data: {
          search: Sea('#inputsearch').val()
        }
      }).then(res => {
        if (res.ok) {
          let html = ''
          for (let i = 0; i < res.data.length; i++) {
            const e = res.data[i]
            const name = e[1]
            const singer = e[2]
            const album = e[3]
            const min = e[4]
            const second = e[5]
            const time = e[4] + ":" + e[5]
            html += `<div class="item" data-key=${i}>
            <div class="name"> ${name}</div>
            <div class="singer">${singer}</div>
            <div class="album">${album}</div>
            <div class="time">${time}</div>
          </div>`
          }
          document.querySelector('#list').innerHTML = html
        }
      })
    })

    Sea('#list').on('click', '.item', function (event) {

      let num = event.target.dataset.key
      let name = Sea('#inputsearch').val()
      if (num >= 0) {
        // let o = Sea.query(window.location.search)
        Sea.Ajax({ //å…ˆåˆ¤æ–­æ­Œæ›²æ˜¯å¦æ”¶è´¹
          url: '/list.isFree',
          data: {
            songName: name,
            songNum: num
          }
        }).then(res => {
          if (res == "isFree") { //å¦‚æœå…è´¹åˆ™è·³è½¬
            window.location.href = '/pages/analyse/analyse.html?songName=' + name + '&songNum=' + num
          } else { //å¦åˆ™æç¤ºç”¨æˆ·æ¢ä¸€é¦–æ­Œ
            alert("æ­Œæ›²éœ€è¦æ”¶è´¹ï¼Œæ— æ³•è§£æï¼Œè¯·æ¢ä¸€é¦–æ­Œ")
          }
        })
      }
    })
    // å–å‚æ•°
    let o = Sea.query(window.location.search)
    console.log('ğŸ¸', o)
    // ä¼ å…¥ input å› ä¸º url ä¸èƒ½å¸¦ä¸­æ–‡ æ‰€ä»¥è¦è§£æä¸€ä¸‹
    let v = decodeURIComponent(o.songName)
    Sea('#inputsearch').val(v)
    Sea('#search').click()
  </script>
</body>

</html>